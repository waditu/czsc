# CZSC 库可视化架构图表

## 1. 整体系统架构图

```
                                    CZSC 量化交易库架构
    ┌─────────────────────────────────────────────────────────────────────────────────────┐
    │                                 CZSC Library                                        │
    │                            (缠中说禅技术分析工具)                                    │
    └─────────────────────────────────────────────────────────────────────────────────────┘
                                           │
                    ┌──────────────────────┼──────────────────────┐
                    │                      │                      │
            ┌───────────────┐      ┌───────────────┐      ┌───────────────┐
            │  数据输入层   │      │  核心计算层   │      │  应用输出层   │
            │ Data Input    │      │ Core Engine   │      │ Application   │
            └───────────────┘      └───────────────┘      └───────────────┘
                    │                      │                      │
    ┌───────────────┼──────────────────────┼──────────────────────┼───────────────┐
    │               │                      │                      │               │
┌─────────┐  ┌─────────┐            ┌─────────┐  ┌─────────┐  ┌─────────┐  ┌─────────┐
│多数据源 │  │数据标准化│            │缠论分析 │  │信号计算 │  │策略回测 │  │实盘交易 │
│connectors│  │utils/   │            │analyze  │  │signals  │  │traders  │  │sensors  │
│9个接口  │  │格式转换 │            │核心算法 │  │247函数  │  │交易框架 │  │传感器   │
└─────────┘  └─────────┘            └─────────┘  └─────────┘  └─────────┘  └─────────┘
     │              │                      │           │           │           │
     │              │                      │           │           │           │
     ▼              ▼                      ▼           ▼           ▼           ▼
┌─────────────────────┐            ┌─────────────────────────────────────────────┐
│    数据层基础设施    │            │              业务逻辑层                    │
│  • K线数据生成器     │            │  • 多级别联立分析                          │
│  • 缓存管理系统     │            │  • 信号-因子-事件体系                      │
│  • 可视化组件库     │            │  • 事件驱动交易                            │
└─────────────────────┘            └─────────────────────────────────────────────┘
                                                      │
                                           ┌─────────────────┐
                                           │   服务支撑层    │
                                           │  • 特征工程     │
                                           │  • 服务组件     │  
                                           │  • 状态自动机   │
                                           └─────────────────┘
```

## 2. 核心模块关系图

```
                              CZSC 核心模块关系图
                         ┌─────────────────────────────┐
                         │        objects.py           │
                         │     (核心数据结构)           │
                         │  RawBar, Signal, Factor     │
                         │  Event, Position, ZS        │
                         └─────────────────────────────┘
                                       │
                         ┌─────────────┴─────────────┐
                         │                           │
                         ▼                           ▼
               ┌─────────────────┐           ┌─────────────────┐
               │   analyze.py    │           │   traders/      │
               │   (缠论引擎)    │◄──────────┤   (交易框架)    │
               │ 分型识别,笔构建  │           │ CzscTrader      │
               │ CZSC(Rust核心)  │           │ CzscSignals     │
               └─────────────────┘           └─────────────────┘
                         │                           │
                         │                           │
                         ▼                           ▼
               ┌─────────────────┐           ┌─────────────────┐
               │   signals/      │◄──────────┤   sensors/      │
               │   (信号生成)    │           │   (传感器)      │
               │ 247专业信号函数  │           │ 事件匹配,CTA研究 │
               │ bar,tas,cxt等   │           │ 特征选择器      │
               └─────────────────┘           └─────────────────┘
                         │                           │
                         └─────────────┬─────────────┘
                                       │
                                       ▼
                         ┌─────────────────────────────┐
                         │        utils/               │
                         │      (工具支撑)             │
                         │ 缓存,可视化,技术分析         │
                         │ 32个工具文件                │
                         └─────────────────────────────┘
                                       │
                    ┌──────────────────┼──────────────────┐
                    │                  │                  │
                    ▼                  ▼                  ▼
          ┌─────────────────┐ ┌─────────────────┐ ┌─────────────────┐
          │   connectors/   │ │     svc/        │ │   features/     │
          │   (数据连接)    │ │   (服务组件)    │ │  (特征工程)     │
          │ 9个数据源接口   │ │ 回测,因子,相关性 │ │ 收益,技术,量价   │
          └─────────────────┘ └─────────────────┘ └─────────────────┘
                                       │
                                       ▼
                         ┌─────────────────────────────┐
                         │         fsa/                │
                         │    (状态自动机)             │
                         │ 笔表分析,信息管理           │
                         └─────────────────────────────┘
```

## 3. 数据流向图

```
                                   CZSC 数据流向图
    
    外部数据源                  数据接入层                  数据处理层
    ┌─────────────┐            ┌─────────────┐            ┌─────────────┐
    │  Tushare    │───────────►│ connectors/ │───────────►│ Bar         │
    │  聚宽JQData │            │ 统一接口    │            │ Generator   │
    │  掘金GMData │            │ 格式转换    │            │ K线合成     │
    │  同花顺QMT  │            │ 异常处理    │            │ 周期管理    │
    │  CCXT加密   │            │ 缓存优化    │            │             │
    │  天勤期货   │            │             │            │             │
    └─────────────┘            └─────────────┘            └─────────────┘
                                      │                          │
                                      │                          │
                                      ▼                          ▼
    标准化数据                  核心分析引擎                 信号计算层
    ┌─────────────┐            ┌─────────────┐            ┌─────────────┐
    │ RawBar[]    │───────────►│ analyze.py  │───────────►│ signals/    │
    │ 标准K线格式 │            │ 去包含关系  │            │ 247个函数   │
    │ OHLCV数据   │            │ 分型识别    │            │ bar,tas,cxt │
    │ 时间序列    │            │ 笔构建      │            │ pos,vol等   │
    │             │            │ CZSC分析    │            │             │
    └─────────────┘            └─────────────┘            └─────────────┘
                                      │                          │
                                      │                          │
                                      ▼                          ▼
    交易执行层                  事件驱动引擎                 应用输出层
    ┌─────────────┐            ┌─────────────┐            ┌─────────────┐
    │ traders/    │◄───────────│ Event       │───────────►│ 回测报告    │
    │ CzscTrader  │            │ Matching    │            │ 交易记录    │
    │ 持仓管理    │            │ 因子组合    │            │ 风险指标    │
    │ 风险控制    │            │ 买卖决策    │            │ 可视化图表  │
    │             │            │             │            │             │
    └─────────────┘            └─────────────┘            └─────────────┘
```

## 4. 信号-因子-事件体系架构图

```
                            信号-因子-事件-交易体系架构
    
    第一层：原始数据                第二层：信号计算               第三层：因子组合
    ┌─────────────────┐            ┌─────────────────┐           ┌─────────────────┐
    │   RawBar数据    │            │   Signal计算    │           │   Factor组合    │
    │                 │            │                 │           │                 │
    │ • OHLC价格      │            │ • K线形态信号   │           │ • signals_all   │
    │ • 成交量Volume  │────────────│ • 技术指标信号  │───────────│ • signals_any   │
    │ • 时间戳dt      │            │ • 缠论分析信号  │           │ • signals_not   │
    │ • 品种symbol    │            │ • 持仓管理信号  │           │ • 逻辑运算      │
    │                 │            │ • 247个函数     │           │                 │
    └─────────────────┘            └─────────────────┘           └─────────────────┘
               │                              │                             │
               │                              │                             │
               ▼                              ▼                             ▼
    标准化K线格式                    标准化信号格式                   标准化因子格式
    freq_dt_open_high               k1_k2_k3 键名格式                name + SHA256哈希
    low_close_vol_amount            v1_v2_v3_score值                逻辑组合运算
               │                              │                             │
               │                              │                             │
               ▼                              ▼                             ▼
    第四层：事件识别                第五层：交易决策                第六层：执行管理
    ┌─────────────────┐            ┌─────────────────┐           ┌─────────────────┐
    │   Event事件     │            │  Trading交易    │           │  Position持仓   │
    │                 │            │                 │           │                 │
    │ • 多因子组合    │            │ • 开仓信号      │           │ • 多头持仓      │
    │ • 操作类型      │────────────│ • 平仓信号      │───────────│ • 空头持仓      │
    │ • 触发条件      │            │ • 仓位管理      │           │ • 风险控制      │
    │ • 事件匹配      │            │ • 资金分配      │           │ • 绩效统计      │
    │                 │            │                 │           │                 │
    └─────────────────┘            └─────────────────┘           └─────────────────┘
```

## 5. 多级别联立分析架构图

```
                              多级别联立分析架构
    
    基础数据输入               BarGenerator自动合成            CzscSignals多级别分析
    ┌─────────────┐           ┌─────────────────────┐         ┌─────────────────────┐
    │ 1分钟K线    │          │                     │         │                     │
    │ RawBar[]    │──────────│  bars = {           │─────────│  kas = {            │
    │ 实时数据流  │          │   '1分钟': [...]    │         │   '1分钟': CZSC()   │
    │             │          │   '5分钟': [...]    │         │   '5分钟': CZSC()   │
    └─────────────┘          │   '15分钟':[...]    │         │   '15分钟':CZSC()   │
           │                 │   '30分钟':[...]    │         │   '30分钟':CZSC()   │
           │                 │   '60分钟':[...]    │         │   '日线': CZSC()    │
           ▼                 │   '日线': [...]     │         │   '周线': CZSC()    │
    自动周期识别              │  }                  │         │  }                  │
    时间对齐处理              │                     │         │                     │
           │                 └─────────────────────┘         └─────────────────────┘
           │                           │                               │
           │                           │                               │
           ▼                           ▼                               ▼
    ┌─────────────┐           ┌─────────────────────┐         ┌─────────────────────┐
    │ 增量更新    │           │ 实时K线合成         │         │ 跨周期信号计算      │
    │ 数据校验    │           │ • 5分钟 = 5×1分钟   │         │ • 短周期：入场信号  │
    │ 异常处理    │           │ • 15分钟= 3×5分钟   │         │ • 中周期：确认信号  │
    │             │           │ • 30分钟= 2×15分钟  │         │ • 长周期：趋势信号  │
    └─────────────┘           │ • 日线 = 4×60分钟   │         │ • 联立分析验证      │
                              │ • 自动时间对齐      │         │                     │
                              └─────────────────────┘         └─────────────────────┘
                                        │                               │
                                        │                               │
                                        ▼                               ▼
                              ┌─────────────────────┐         ┌─────────────────────┐
                              │ CzscTrader交易执行  │◄────────│ 多级别信号融合      │
                              │                     │         │                     │
                              │ • 事件驱动交易      │         │ • 信号权重分配      │
                              │ • 多级别验证        │         │ • 信号冲突处理      │
                              │ • 风险管理          │         │ • 信号优先级排序    │
                              │ • 持仓管理          │         │ • 多周期共振识别    │
                              │                     │         │                     │
                              └─────────────────────┘         └─────────────────────┘
```

## 6. 性能优化架构图

```
                                 CZSC 性能优化架构
    
    应用层 (Python)                中间层 (优化)                 底层 (高性能)
    ┌─────────────────┐           ┌─────────────────┐           ┌─────────────────┐
    │ 业务逻辑代码    │           │ 性能优化层      │           │ 底层计算引擎    │
    │                 │           │                 │           │                 │
    │ • Strategy策略  │           │ • 智能缓存      │           │ • Rust Core     │
    │ • Signal信号    │───────────│ • 向量化计算    │───────────│ • rs_czsc模块   │
    │ • Factor因子    │           │ • 并行处理      │           │ • 内存优化      │
    │ • Event事件     │           │ • 数据预处理    │           │ • 算法优化      │
    │                 │           │                 │           │                 │
    └─────────────────┘           └─────────────────┘           └─────────────────┘
            │                             │                             │
            │                             │                             │
            ▼                             ▼                             ▼
    ┌─────────────────┐           ┌─────────────────┐           ┌─────────────────┐
    │ 用户接口友好    │           │ 性能监控优化    │           │ 计算性能极致    │
    │                 │           │                 │           │                 │
    │ • 简单易用API   │           │ • DiskCache     │           │ • 核心算法      │
    │ • 丰富组件库    │           │ • Memory优化    │           │ • 数据结构      │
    │ • 可视化界面    │           │ • 批量处理      │           │ • 并发安全      │
    │ • 文档完善      │           │ • 流式计算      │           │ • 零拷贝优化    │
    │                 │           │                 │           │                 │
    └─────────────────┘           └─────────────────┘           └─────────────────┘
            │                             │                             │
            └─────────────┬───────────────┴─────────────┬───────────────┘
                          │                             │
                          ▼                             ▼
                ┌─────────────────┐             ┌─────────────────┐
                │ 缓存系统        │             │ 监控系统        │
                │                 │             │                 │
                │ • Redis分布式   │             │ • 性能监控      │
                │ • 本地磁盘      │             │ • 内存监控      │
                │ • 内存缓存      │             │ • 异常监控      │
                │ • TTL过期       │             │ • 日志审计      │
                │                 │             │                 │
                └─────────────────┘             └─────────────────┘
```

## 7. 部署架构图

```
                               CZSC 部署架构图
    
    开发环境                    测试环境                    生产环境
    ┌─────────────────┐        ┌─────────────────┐        ┌─────────────────┐
    │ Local Dev       │        │ Testing Env     │        │ Production      │
    │                 │        │                 │        │                 │
    │ • Jupyter       │        │ • 单元测试      │        │ • 实盘交易      │
    │ • IDE开发       │────────│ • 集成测试      │────────│ • 风控监控      │
    │ • 策略调试      │        │ • 性能测试      │        │ • 高可用部署    │
    │ • 回测验证      │        │ • 数据验证      │        │ • 负载均衡      │
    │                 │        │                 │        │                 │
    └─────────────────┘        └─────────────────┘        └─────────────────┘
            │                          │                          │  
            │                          │                          │
            ▼                          ▼                          ▼
    ┌─────────────────┐        ┌─────────────────┐        ┌─────────────────┐
    │ 本地环境配置    │        │ 容器化部署      │        │ 云原生架构      │
    │                 │        │                 │        │                 │
    │ • Python虚拟环境│        │ • Docker容器    │        │ • Kubernetes    │
    │ • 依赖管理UV    │        │ • CI/CD流水线   │        │ • 微服务架构    │
    │ • 配置文件      │        │ • 自动化测试    │        │ • 服务网格      │
    │ • 调试工具      │        │ • 质量门禁      │        │ • 监控告警      │
    │                 │        │                 │        │                 │
    └─────────────────┘        └─────────────────┘        └─────────────────┘
                                        │
                                        │
                                        ▼
                              ┌─────────────────┐
                              │ 数据基础设施    │
                              │                 │
                              │ • Redis缓存     │
                              │ • 时序数据库    │
                              │ • 对象存储      │
                              │ • 消息队列      │
                              │ • 数据同步      │
                              │                 │
                              └─────────────────┘
```

## 8. 技术栈架构图

```
                                CZSC 技术栈架构
    
    前端展示层                    业务逻辑层                   数据存储层
    ┌─────────────────┐          ┌─────────────────┐          ┌─────────────────┐
    │ Web界面         │          │ Python应用      │          │ 数据存储        │
    │                 │          │                 │          │                 │
    │ • Streamlit     │          │ • CZSC Library  │          │ • Redis缓存     │
    │ • ECharts图表   │──────────│ • 策略逻辑      │──────────│ • 本地存储      │
    │ • Plotly交互    │          │ • 信号计算      │          │ • 对象存储OSS   │
    │ • HTML报告      │          │ • 风险管理      │          │ • 时序数据库    │
    │                 │          │                 │          │                 │
    └─────────────────┘          └─────────────────┘          └─────────────────┘
            │                            │                            │
            │                            │                            │
            ▼                            ▼                            ▼
    ┌─────────────────┐          ┌─────────────────┐          ┌─────────────────┐
    │ 展示技术栈      │          │ 计算技术栈      │          │ 存储技术栈      │
    │                 │          │                 │          │                 │
    │ • JavaScript    │          │ • Python 3.12+ │          │ • Dill序列化    │
    │ • CSS样式       │          │ • NumPy科学计算 │          │ • JSON格式      │
    │ • Web组件       │          │ • Pandas数据    │          │ • Feather格式   │
    │ • 响应式设计    │          │ • Rust高性能    │          │ • Parquet格式   │
    │                 │          │                 │          │                 │
    └─────────────────┘          └─────────────────┘          └─────────────────┘
                                          │
                                          │
                                          ▼
                                ┌─────────────────┐
                                │ 核心依赖栈      │
                                │                 │
                                │ • loguru日志    │
                                │ • tqdm进度条    │
                                │ • requests网络  │
                                │ • cryptography  │
                                │ • ta-lib技术    │
                                │ • scipy科学     │
                                │ • statsmodels   │
                                │                 │
                                └─────────────────┘
```

这些可视化图表全面展示了CZSC库的架构设计，从不同角度诠释了系统的组织结构、数据流向、技术实现和部署方式，为开发者和用户提供了清晰的架构理解。