# CZSC 库架构分析文档

## 项目概述

CZSC（缠中说禅技术分析工具）是基于缠中说禅理论的综合性量化交易Python库，提供技术分析、信号生成、回测和市场分析等功能。本项目专注于实现缠论的分型、笔、线段等核心概念的自动识别，以及基于此的多级别量化交易策略。

## 整体架构图

```
                           CZSC 库整体架构
                    ┌─────────────────────────────────┐
                    │         CZSC Library            │
                    │        (czsc.__init__)          │
                    └─────────────────────────────────┘
                                    │
           ┌────────────────────────┼────────────────────────┐
           │                        │                        │
    ┌─────────────┐        ┌─────────────┐        ┌─────────────┐
    │ Core Engine │        │   Trading   │        │  Analysis   │
    │             │        │  Framework  │        │   & Utils   │
    └─────────────┘        └─────────────┘        └─────────────┘
           │                        │                        │
    ┌─────────────┐        ┌─────────────┐        ┌─────────────┐
    │ objects.py  │        │  traders/   │        │   utils/    │
    │ analyze.py  │        │  signals/   │        │ connectors/ │
    │             │        │  sensors/   │        │    svc/     │
    └─────────────┘        └─────────────┘        └─────────────┘
```

## 模块划分说明

### 1. 核心引擎层 (Core Engine)

**核心职责**: 实现缠论的基础理论和数据结构

- **`objects.py`**: 核心数据结构定义
  - `RawBar`: 原始K线数据
  - `NewBar`: 处理包含关系后的K线
  - `Signal`, `Factor`, `Event`: 信号-因子-事件体系
  - `Position`: 持仓管理
  - `FX`, `BI`, `ZS`: 分型、笔、中枢等缠论概念

- **`analyze.py`**: 缠论分析核心实现
  - `CZSC`: 缠中说禅分析主类
  - 分型识别和去包含关系处理
  - 笔的自动识别算法
  - 线段和中枢的构建逻辑

### 2. 交易框架层 (Trading Framework)

**核心职责**: 提供信号生成、策略执行和交易管理

- **`traders/`**: 交易执行框架
  - `base.py`: CzscSignals 和 CzscTrader 核心类
  - `cwc.py`: 权重交易客户端
  - `rwc.py`: Redis权重管理客户端
  - `performance.py`: 交易表现分析
  - `optimize.py`: 策略优化工具

- **`signals/`**: 信号生成系统 (按类别组织)
  - `bar.py`: K线级别信号
  - `pos.py`: 持仓相关信号
  - `cxt.py`: 上下文信号
  - `tas.py`: 技术分析信号
  - `vol.py`: 成交量信号
  - 其他专业信号模块

- **`sensors/`**: 事件检测和特征分析
  - `cta.py`: CTA研究框架
  - `feature.py`: 特征选择器和分析器
  - `event.py`: 事件匹配和检测

### 3. 分析工具层 (Analysis & Utils)

**核心职责**: 提供数据处理、可视化和外部集成

- **`utils/`**: 工具模块集合
  - `bar_generator.py`: K线数据生成和重采样
  - `cache.py`: 磁盘缓存工具
  - `st_components.py`: Streamlit仪表板组件
  - `ta.py`: 技术分析指标
  - `echarts_plot.py`, `plotly_plot.py`: 可视化工具

- **`connectors/`**: 数据源连接器
  - 支持多种数据源接口 (聚宽、掘金、同花顺等)
  - 统一的数据获取和格式化接口

- **`svc/`**: 服务组件
  - `backtest.py`: 回测引擎
  - `correlation.py`: 相关性分析
  - `factor.py`: 因子分析
  - `strategy.py`: 策略服务

- **`features/`**: 特征工程
  - 技术分析特征计算
  - 特征变换和处理工具

- **`fsa/`**: 有限状态自动机
  - 高级分析工具
  - 笔表分析等复杂功能

## 核心设计理念

### 1. 信号-因子-事件-交易体系

```
Raw Data → Signals → Factors → Events → Trading Decisions
   ↓         ↓         ↓         ↓           ↓
K线数据   基础信号   因子组合   事件识别    交易执行
```

### 2. 多级别联立分析

- 支持同时分析多个时间周期 (1分钟、5分钟、30分钟、日线等)
- 通过 `CzscTrader` 类实现多级别协同决策
- `BarGenerator` 负责不同周期K线的生成和维护

### 3. 模块化和可扩展设计

- 每个模块都有清晰的职责边界
- 信号函数采用标准化接口，便于扩展
- 缓存机制提高计算效率
- 支持多种数据源的插件式接入

### 4. 缠论核心概念实现

- **分型识别**: 自动识别顶分型和底分型
- **去包含关系**: 处理K线的包含关系
- **笔的构建**: 基于分型序列构建笔
- **中枢识别**: 识别和分析价格中枢
- **买卖点定位**: 基于缠论理论的买卖点算法

## 技术特点

1. **高性能**: 使用 Rust 扩展 (rs_czsc) 加速核心计算
2. **易用性**: 提供丰富的可视化和分析工具
3. **扩展性**: 模块化设计，支持自定义信号和策略
4. **实用性**: 集成多种数据源和回测框架
5. **专业性**: 严格按照缠论理论实现各项功能
